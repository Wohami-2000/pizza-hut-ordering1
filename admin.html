<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <title>Pizza Hut - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="p-4 max-w-xl mx-auto text-gray-900">
<button onclick="window.print()" style="background:#3182ce;color:white;padding:10px;border:none;border-radius:5px;margin-bottom:20px;cursor:pointer;">
  Print Orders
</button>
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold">ðŸ“‹ Incoming Orders</h1>
    <button id="logout" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">Logout</button>
  </div>

  <div id="orders" class="space-y-4"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script> <!-- Auth -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="firebase.js"></script>

  <script>
    const auth = firebase.auth();
    const db = firebase.database();
    const container = document.getElementById("orders");

    // Protect admin page â€” redirect if not logged in
    auth.onAuthStateChanged(user => {
      if (!user) {
        window.location.href = "admin-login.html";  // Redirect to login page
      } else {
        // User logged in â†’ show orders
        db.ref("orders").on("value", snapshot => {
          container.innerHTML = "";
          const data = snapshot.val();

          if (!data) {
            container.innerHTML = "<p>No orders yet.</p>";
            return;
          }

          Object.entries(data).reverse().forEach(([id, order]) => {
            const div = document.createElement("div");
            div.className = "bg-white rounded shadow p-4";

            div.innerHTML = `
              <h2 class="font-bold text-lg mb-2">Table #${order.table}</h2>
              <ul class="mb-2">
                ${order.items.map(i => `<li>${i.qty} x ${i.name} (${i.price} MAD)</li>`).join("")}
              </ul>
              <p class="font-semibold">Total: ${order.total} MAD</p>
              <p class="text-sm text-gray-500">${new Date(order.timestamp).toLocaleString()}</p>
            `;

            container.appendChild(div);
          });
        });
      }
    });

    // Logout button
    document.getElementById("logout").addEventListener("click", () => {
      auth.signOut().then(() => {
        window.location.href = "admin-login.html";
      });
    });
  </script>
</body>
</html>
